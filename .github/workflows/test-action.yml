name: Test Action

on:
  pull_request:

permissions:
  contents: read
  pull-requests: write

jobs:
  test-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run Agentic AppSec (shadow mode)
        id: appsec
        uses: ./
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          mode: shadow
          ai_api_key: ${{ secrets.AI_API_KEY }}
          ai_model: gemini/gemini-2.0-flash

      - name: Show results
        run: |
          echo "Decision: ${{ steps.appsec.outputs.decision }}"
          echo "Continue: ${{ steps.appsec.outputs.continue_pipeline }}"
          echo "Findings: ${{ steps.appsec.outputs.findings_count }}"
          echo "Reason: ${{ steps.appsec.outputs.reason }}"
          echo "Safety warnings: ${{ steps.appsec.outputs.safety_warnings_count }}"
          echo "Excepted: ${{ steps.appsec.outputs.excepted_count }}"
